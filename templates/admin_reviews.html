<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãƒ¬ãƒ“ãƒ¥ãƒ¼ç®¡ç†ç”»é¢</title>
  <link rel="stylesheet" href="/static/style.css">
  <style>
    /* ãƒ†ãƒ¼ãƒ–ãƒ«å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    table {
        width: 100%;
        border-collapse: collapse;
        background-color: white; /* èƒŒæ™¯ã‚’ç™½ã */
    }

    th, td {
        border: 1px solid #ddd; /* æ ç·šã‚’è¡¨ç¤º */
        padding: 10px;
        text-align: center; /* ã‚»ãƒ«å†…ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¸­å¤®æƒãˆ */
    }

    th {
        background-color: #f4f4f4; /* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æ·¡ã„ã‚°ãƒ¬ãƒ¼ */
        font-weight: bold;
    }

    /* æ¨è–¦ã‚¹ã‚³ã‚¢ã®ã‚»ãƒ«ã®èƒŒæ™¯è‰²ã‚’ã‚¹ã‚³ã‚¢ã«å¿œã˜ã¦å¤‰æ›´ */
    .score-non {
        background-color: white; 
    }

    .score-low {
        background-color: #d6ebff; 
    }

    .score-mid {
        background-color: #cce5ff; /* æ·¡ã„ãƒ–ãƒ«ãƒ¼ */
    }

    .score-high {
        background-color: #99ccff; /* æ¿ƒã„ãƒ–ãƒ«ãƒ¼ */
    }

    /* æ˜Ÿãƒãƒ¼ã‚¯ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .stars {
        color: gold;
        font-weight: bold;
    }


    .cluster-table-container {
        max-width: 400px; /* æ¨ªå¹…ã‚’åˆ¶é™ */
        margin: 0 auto; /* ä¸­å¤®é…ç½® */
        padding: 10px;
        background-color: #f9f9f9; /* èƒŒæ™¯ã‚’å°‘ã—ç°è‰²ã« */
        border-radius: 8px; /* è§’ã‚’ä¸¸ã‚ã‚‹ */
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* å½±ã‚’è¿½åŠ  */
    }

    .cluster-table {
        width: 100%;
        border-collapse: collapse;
        table-layout: auto;
        font-size: 14px;
    }

    .cluster-table th, .cluster-table td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: center;
    }

    .cluster-table th {
        background-color: #ddd; /* ãƒ˜ãƒƒãƒ€ãƒ¼ã®èƒŒæ™¯è‰² */
        font-weight: bold;
    }

    .recommendation-box {
    background-color: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.15);
    max-width: 500px;
    margin: 20px auto;
    text-align: center;
    }

    .recommendation-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }

    .recommendation-table th, .recommendation-table td {
        border: 1px solid #ddd;
        padding: 8px;
    }

    .recommendation-table th {
        background-color: #f8f8f8;
        font-weight: bold;
    }
    td.description {
        white-space: pre-line;
    }

</style>
</head>
<body>
  <h1>ãƒ¦ãƒ¼ã‚¶ãƒ¼ Ã— è©•ä¾¡å¯¾è±¡ è©•ä¾¡ä¸€è¦§</h1>

    <h2>æ¨è–¦ã‚¹ã‚³ã‚¢</h2>
    <div class="recommendation-box">
      <p>
          æ¨è–¦ã‚¹ã‚³ã‚¢ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ã¨é¡ä¼¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‚¾å‘ã‚’åŸºã«ç®—å‡ºã—ã¦ã„ã¾ã™ã€‚<br>
          <strong>ã‚¹ã‚³ã‚¢ãŒé«˜ã„ã»ã©æ¨è–¦åº¦ãŒé«˜ããªã‚Šã¾ã™ã€‚</strong>
      </p>
      <table class="recommendation-table">
          <tr>
              <th>ã‚¹ã‚³ã‚¢</th>
              <th>è©•ä¾¡</th>
          </tr>
          <tr>
              <td>0.75ä»¥ä¸Š</td>
              <td>â˜…â˜…â˜…ï¼ˆç‰¹ã«å¼·ããŠã™ã™ã‚ï¼‰</td>
          </tr>
          <tr>
              <td>0.5ä»¥ä¸Š</td>
              <td>â˜…â˜…ï¼ˆå¼·ããŠã™ã™ã‚ï¼‰</td>
          </tr>
          <tr>
              <td>0.25ä»¥ä¸Š</td>
              <td>â˜…ï¼ˆãŠã™ã™ã‚ï¼‰</td>
          </tr>
          <tr>
              <td>0.25æœªæº€</td>
              <td>æ¨è–¦ãªã—</td>
          </tr>
      </table>
    </div>
    <table>
        <thead>
            <tr>
                <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼</th>
                {% for obj_name in column_names %}
                    <th>{{ obj_name }}</th>  {# object_name ã‚’è¡¨ç¤º #}
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for row in pivot_table %}
            <tr>
                <td>{{ row.username }}</td>
                {% for obj_name in column_names %}
                {% set cell_content = row.get(obj_name, '-') %}
                {% set score = '-' %}
                
                {% if cell_content is not none and 'RS:' in cell_content %}
                    {% set parts = cell_content.split('\n') %}
                    {% if parts | length > 2 %}
                        {% set score = parts[2].replace('RS: ', '') %}
                    {% endif %}
                {% endif %}

                {% set score_class = '' %}
                {% if score != '-' %}
                    {% set score_float = score | float %}
                    {% if score_float >= 0.75 %}
                        {% set score_class = 'score-high' %}
                    {% elif score_float >= 0.5 %}
                        {% set score_class = 'score-mid' %}
                    {% elif score_float >= 0.25 %}
                        {% set score_class = 'score-low' %}
                    {% else %}
                        {% set score_class = 'score-non' %}
                    {% endif %}
                {% endif %}

                <td class="{{ score_class }}">{{ cell_content | safe }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2>æ¨è–¦ã‚¹ã‚³ã‚¢ã®åˆ†å¸ƒã¨ã‚«ãƒ¼ãƒãƒ«å¯†åº¦æ¨å®š</h2>
    <img src="data:image/png;base64,{{ recommendation_hist_base64 | safe }}" alt="æ¨è–¦ã‚¹ã‚³ã‚¢ã®ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ">

    <h2>ãƒ¦ãƒ¼ã‚¶ãƒ¼é¡ä¼¼åº¦ã®ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—</h2>
    <img src="data:image/png;base64,{{ heatmap_base64 | safe }}" alt="ãƒ¦ãƒ¼ã‚¶ãƒ¼é¡ä¼¼åº¦ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—">

    <h2>ãƒ¦ãƒ¼ã‚¶ãƒ¼é¡ä¼¼åº¦ã®åˆ†å¸ƒã¨ã‚«ãƒ¼ãƒãƒ«å¯†åº¦æ¨å®š</h2>
    <img src="data:image/png;base64,{{ similarity_hist_base64 | safe }}" alt="ãƒ¦ãƒ¼ã‚¶ãƒ¼é¡ä¼¼åº¦ã®ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ">

    <h2>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°</h2>
    <!-- ã‚¯ãƒ©ã‚¹ã‚¿è¡¨ã‚’æ¨ªä¸¦ã³ã«é…ç½® -->
<div class="cluster-table-container">
    <div class="cluster-table">
        <h3>ãƒ¦ãƒ¼ã‚¶ãƒ¼åé † (ABCé †)</h3>
        <table class="cluster-table">
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Cluster</th>
                </tr>
            </thead>
            <tbody>
                {% for user in cluster_sorted_by_username %}
                <tr>
                    <td>{{ user.username }}</td>
                    <td>{{ user.cluster }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- ã‚¯ãƒ©ã‚¹ã‚¿é †ã®ã‚¯ãƒ©ã‚¹ã‚¿è¡¨ -->
    <div class="cluster-table">
        <h3>ã‚¯ãƒ©ã‚¹ã‚¿é †</h3>
        <table class="cluster-table">
            <thead>
                <tr>
                    <th>Cluster</th>
                    <th>Username</th>
                </tr>
            </thead>
            <tbody>
                {% for user in cluster_sorted_by_cluster %}
                <tr>
                    <td>{{ user.cluster }}</td>
                    <td>{{ user.username }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<style>
    .cluster-container {
        display: flex;         /* æ¨ªä¸¦ã³ã«ã™ã‚‹ */
        justify-content: space-between; /* å‡ç­‰ã«é…ç½® */
        gap: 20px;             /* ä½™ç™½ã‚’è¨­ã‘ã‚‹ */
    }
    
    .cluster-table {
        flex: 1;               /* å„è¡¨ã‚’å‡ç­‰ãªå¹…ã« */
        min-width: 300px;       /* æœ€å°å¹…ã‚’æŒ‡å®š */
    }

    /* ğŸ“± ã‚¹ãƒãƒ›å¯¾å¿œ (768pxä»¥ä¸‹ã§ã¯ç¸¦ä¸¦ã³) */
    @media (max-width: 768px) {
        .cluster-container {
            flex-direction: column; /* ç¸¦ä¸¦ã³ã«åˆ‡ã‚Šæ›¿ãˆ */
        }
    }
</style>   

    <h2>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã®å¯è¦–åŒ–</h2>
    <img src="data:image/png;base64,{{ cluster_plot_base64 | safe }}" alt="ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã®å¯è¦–åŒ–">

</body>
</html>
